# 🚀 GachaEgg 完整部署教學

本文件包含從零開始的完整部署流程，適合第一次部署的使用者。

---

## 📋 目錄

1. [前置準備](#前置準備)
2. [推送代碼到 GitHub](#推送代碼到-github)
3. [部署後端到 Render](#部署後端到-render)
4. [部署前端到 Vercel](#部署前端到-vercel)
5. [測試與驗證](#測試與驗證)
6. [常見問題](#常見問題)

---

## 🎯 前置準備

### 必要帳號
- ✅ GitHub 帳號（https://github.com/）
- ✅ Render 帳號（https://render.com/）
- ✅ Vercel 帳號（https://vercel.com/）

**建議：三個帳號都用 GitHub 登入，方便管理**

### 本地環境
- ✅ Node.js 18+ 已安裝
- ✅ Git 已安裝
- ✅ 專案在本地可正常運行

---

## 📦 步驟一：推送代碼到 GitHub

### 1.1 初始化 Git 倉庫

```bash
# 進入專案目錄
cd D:\TestProject\GachaEgg

# 初始化 Git
git init

# 設定 Git 用戶資訊
git config user.name "您的GitHub用戶名"
git config user.email "您的郵箱"
```

### 1.2 提交代碼

```bash
# 添加所有文件
git add .

# 提交
git commit -m "Initial commit: Gacha game project"

# 設定主分支為 main
git branch -M main
```

### 1.3 創建 GitHub 倉庫

1. 前往 https://github.com/new
2. 填寫資訊：
   - **Repository name**: `GatchaEgg`（或您喜歡的名稱）
   - **Description**: `多人抽蛋對戰遊戲`
   - 選擇 **Public**（重要！部署平台需要存取）
   - ❌ 不要勾選任何額外選項
3. 點擊 **"Create repository"**

### 1.4 推送到 GitHub

```bash
# 添加遠端倉庫（替換成您的用戶名和倉庫名）
git remote add origin https://github.com/您的用戶名/GatchaEgg.git

# 推送代碼
git push -u origin main
```

**注意**：如果提示需要驗證，使用 Personal Access Token（不是密碼）

**如何獲取 Token：**
1. 前往 https://github.com/settings/tokens/new
2. 勾選 `repo` 權限
3. 生成並複製 token
4. 推送時將 token 作為密碼輸入

✅ **完成！代碼已在 GitHub 上**

---

## 🖥️ 步驟二：部署後端到 Render

### 2.1 註冊並登入 Render

1. 前往 https://render.com/
2. 點擊 **"Get Started"** 或 **"Sign Up"**
3. 選擇 **"Sign in with GitHub"**（推薦）
4. 授權 Render 存取您的 GitHub

### 2.2 建立 Web Service

1. 登入後，點擊 **"New +"** 按鈕
2. 選擇 **"Web Service"**
3. 點擊 **"Connect account"** 連接 GitHub（如果還沒連接）
4. 在倉庫列表中找到 **"GatchaEgg"**
   - 如果看不到，點擊 **"Configure account"** 給予權限
5. 點擊倉庫旁的 **"Connect"** 按鈕

### 2.3 配置服務設定

填寫以下資訊（重要！每項都要正確）：

```
Name（服務名稱）
└─ gatchaegg-backend

Region（區域）
└─ Singapore（或選擇離您最近的）

Branch（分支）
└─ main

Root Directory（根目錄）⚠️ 重要
└─ server

Runtime（執行環境）
└─ Node

Build Command（建置指令）
└─ npm install

Start Command（啟動指令）
└─ npm start

Instance Type（方案）
└─ Free
```

### 2.4 設定環境變數

往下滾動找到 **"Environment Variables"** 或點擊 **"Advanced"**

添加以下三個環境變數：

| Key | Value |
|-----|-------|
| `PORT` | `3000` |
| `NODE_ENV` | `production` |
| `CORS_ORIGIN` | `*` |

**添加方式：**
1. 點擊 **"Add Environment Variable"**
2. 輸入 Key 和 Value
3. 重複三次添加所有變數

### 2.5 開始部署

1. 檢查所有設定是否正確
2. 點擊底部的 **"Create Web Service"** 按鈕
3. 等待部署（約 3-5 分鐘）

**部署過程：**
- 會看到建置日誌滾動
- 出現 "🚀 伺服器運行於..." 表示成功
- 狀態變成綠色 **"Live"**

### 2.6 記下後端 URL

部署成功後，在頁面頂部會看到您的後端 URL：

```
https://gatchaegg-backend-xxxx.onrender.com
```

**📝 重要：複製這個 URL，稍後需要用到！**

### 2.7 測試後端

在瀏覽器訪問您的後端 URL（直接訪問，不加任何路徑）：

```
https://gatchaegg-backend-xxxx.onrender.com
```

**應該看到：**
```json
{
  "message": "多人抽蛋對戰遊戲 API",
  "version": "1.0.0",
  "status": "running"
}
```

✅ **完成！後端已成功部署**

---

## 🎨 步驟三：部署前端到 Vercel

### 3.1 註冊並登入 Vercel

1. 前往 https://vercel.com/
2. 點擊 **"Sign Up"** 或 **"Login"**
3. 選擇 **"Continue with GitHub"**（推薦）
4. 授權 Vercel 存取您的 GitHub

### 3.2 導入專案

1. 登入後，點擊 **"Add New..."** 或 **"New Project"**
2. 選擇 **"Import Git Repository"**
3. 如果看不到您的倉庫：
   - 點擊 **"Adjust GitHub App Permissions"**
   - 給予 Vercel 存取 **GatchaEgg** 倉庫的權限
4. 找到 **"XiuHua0825/GatchaEgg"**（或您的用戶名）
5. 點擊 **"Import"** 按鈕

### 3.3 配置專案設定

**Framework Preset（框架預設）：**
- 選擇 **"Vite"**（應該會自動偵測）

**Root Directory（根目錄）：** ⚠️ 重要
1. 點擊 **"Edit"** 按鈕
2. 選擇 **"client"** 資料夾
3. 點擊 **"Continue"**

**Build and Output Settings（建置設定）：**
- Build Command: `npm run build`（通常自動填入）
- Output Directory: `dist`（通常自動填入）
- Install Command: `npm install`（通常自動填入）

### 3.4 設定環境變數（最關鍵！）

展開 **"Environment Variables"** 區域

**添加環境變數：**

| Key | Value |
|-----|-------|
| `VITE_SOCKET_URL` | `https://gatchaegg-backend-xxxx.onrender.com` |

**⚠️ 重要：**
- Value 要填入您在步驟 2.6 記下的後端 URL
- 不要有結尾的 `/`
- 確保選擇 **"Production"** 環境

**填寫方式：**
1. Key 欄位輸入：`VITE_SOCKET_URL`
2. Value 欄位輸入：您的後端 URL
3. Environment 確保勾選：`Production`
4. 點擊 **"Add"** 按鈕

### 3.5 開始部署

1. 檢查所有設定：
   - ✅ Framework: Vite
   - ✅ Root Directory: client
   - ✅ Environment Variable: VITE_SOCKET_URL 已設定
2. 點擊底部的 **"Deploy"** 按鈕
3. 等待部署（約 1-3 分鐘）

**部署過程：**
- 會看到建置進度
- 出現 "🎉 Congratulations!" 表示成功
- 獲得您的遊戲網址

### 3.6 獲取遊戲網址

部署成功後會顯示您的遊戲網址：

```
https://gatcha-egg-xxxx.vercel.app
```

或者在專案頁面頂部也能看到。

✅ **完成！前端已成功部署**

---

## ✅ 步驟四：測試與驗證

### 4.1 測試後端 API

**測試根路徑：**
```
https://gatchaegg-backend-xxxx.onrender.com/
```
應該看到 API 資訊的 JSON

**測試蛋資料 API：**
```
https://gatchaegg-backend-xxxx.onrender.com/api/eggs
```
應該看到扭蛋列表的 JSON

### 4.2 測試前端遊戲

**開啟遊戲網址：**
```
https://gatcha-egg-xxxx.vercel.app/
```

**檢查項目：**
- ✅ 頁面正常載入
- ✅ 顯示「✅ 已連線」（可能需要等待 30 秒，後端首次喚醒）
- ✅ 能看到扭蛋選項（30元/50元/100元）
- ✅ 能輸入玩家名稱

### 4.3 測試單人模式

1. 輸入玩家名稱
2. 點擊「單人抽蛋」
3. 選擇扭蛋類型
4. 點擊「開始抽蛋」
5. 查看抽卡結果
6. 檢查抽卡紀錄是否正常顯示

### 4.4 測試對戰模式

**玩家 A（建立房間）：**
1. 輸入名稱，選擇「對戰模式」
2. 點擊「建立房間」
3. 選擇扭蛋類型和數量
4. 複製房間號

**玩家 B（加入房間）：**
1. 用另一個瀏覽器或手機開啟遊戲
2. 輸入名稱，選擇「對戰模式」
3. 點擊「加入房間」
4. 輸入房間號
5. 觀察倒數和對戰結果

### 4.5 測試大獎廣播

當抽到大獎時，應該會在頁面頂部顯示金色的廣播訊息。

✅ **所有功能正常，部署完成！**

---

## 🌐 步驟五：分享您的遊戲

您的遊戲網址：
```
https://gatcha-egg-xxxx.vercel.app/
```

**可以：**
- 📱 分享給朋友
- 🌍 在社交媒體發佈
- 💬 放在個人簡介
- 📧 通過郵件分享

**所有人都可以直接訪問，無需安裝！**

---

## 🔄 更新部署流程

當您修改代碼後，如何更新線上版本：

### 本地修改代碼

```bash
# 1. 修改代碼
# 2. 測試確認無誤

# 3. 提交變更
git add .
git commit -m "Update: description of changes"

# 4. 推送到 GitHub
git push origin main
```

**自動部署：**
- Render 會自動偵測更新並重新部署後端（約 3-5 分鐘）
- Vercel 會自動偵測更新並重新部署前端（約 1-2 分鐘）

**無需任何手動操作！**

---

## ❓ 常見問題

### Q1: 前端顯示「連線中...」無法連線

**原因：** Render 免費方案會休眠

**解決：**
1. 訪問後端 URL 喚醒：`https://gatchaegg-backend-xxxx.onrender.com`
2. 等待 30-60 秒
3. 重新整理前端頁面

**預防：** 使用 [UptimeRobot](https://uptimerobot.com/) 每 5 分鐘 ping 一次後端

---

### Q2: 看不到扭蛋選項

**原因：** 環境變數未正確設定或前端無法連接後端

**解決：**
1. 檢查 Vercel 環境變數 `VITE_SOCKET_URL` 是否正確
2. 按 F12 開啟開發者工具查看 Console 錯誤
3. 確認後端 `/api/eggs` 可正常訪問
4. 重新部署 Vercel

---

### Q3: 對戰房間無法加入

**原因：** Socket.IO 連線問題

**解決：**
1. 確認兩個玩家都顯示「✅ 已連線」
2. 檢查房間號是否正確（6 碼英數字）
3. 確認後端正在運行（訪問後端 URL）
4. 查看瀏覽器 Console 錯誤訊息

---

### Q4: 部署後顯示 404 錯誤

**Render 顯示 404：**
- 檢查 Root Directory 是否設定為 `server`
- 檢查 Start Command 是否為 `npm start`
- 查看 Logs 標籤的錯誤訊息

**Vercel 顯示 404：**
- 檢查 Root Directory 是否設定為 `client`
- 檢查 Framework Preset 是否為 `Vite`
- 重新部署

---

### Q5: 如何查看伺服器日誌

**Render 日誌：**
1. 前往 Render Dashboard
2. 點擊服務名稱
3. 點擊 **"Logs"** 標籤
4. 查看即時日誌

**Vercel 日誌：**
1. 前往 Vercel Dashboard
2. 點擊專案名稱
3. 點擊 **"Deployments"** 標籤
4. 點擊最新部署查看建置日誌

---

### Q6: 如何更新環境變數

**Render：**
1. 進入服務頁面
2. 點擊 **"Environment"** 標籤
3. 修改或添加變數
4. 點擊 **"Save Changes"**
5. 服務會自動重新部署

**Vercel：**
1. 進入專案頁面
2. 點擊 **"Settings"** → **"Environment Variables"**
3. 修改或添加變數
4. 返回專案頁面
5. 點擊 **"..."** → **"Redeploy"** 重新部署

---

### Q7: 費用會很貴嗎？

**完全免費！**

**Render 免費方案：**
- 750 小時/月（足夠使用）
- 閒置後會休眠（正常現象）

**Vercel 免費方案：**
- 無限部署
- 100GB 流量/月
- 完全足夠個人專案使用

**升級需求：**
- 只有在大量用戶同時在線時才需要考慮升級
- Render Pro: $7/月（不休眠）
- Vercel Pro: $20/月（更多流量和功能）

---

## 📊 監控與維護

### 查看流量數據

**Render：**
- Dashboard → 選擇服務 → Metrics 標籤
- 可查看 CPU、記憶體、流量

**Vercel：**
- Dashboard → 選擇專案 → Analytics 標籤
- 可查看訪問量、訪客數

### 保持後端活躍（避免休眠）

使用 **UptimeRobot**：
1. 註冊 https://uptimerobot.com/
2. 添加 Monitor
3. URL: `https://gatchaegg-backend-xxxx.onrender.com/health`
4. 間隔: 5 分鐘
5. 免費！

---

## 🎉 完成！

恭喜您成功部署了一個完整的多人線上遊戲！

**您的遊戲：**
- 🌍 全球可訪問
- 📱 支援所有設備
- 🔄 自動擴展
- ☁️ 雲端運行（不需要您的電腦）

**下一步：**
- 📣 分享給朋友
- 📊 監控使用數據
- 🎨 自訂遊戲內容（參考「遊戲內容管理教學.md」）
- 🌐 綁定自己的網域名稱

---

## 📞 需要幫助？

- 📖 [Render 文檔](https://render.com/docs)
- 📖 [Vercel 文檔](https://vercel.com/docs)
- 📖 [專案 README](./README.md)

祝您遊戲愉快！🎰✨

